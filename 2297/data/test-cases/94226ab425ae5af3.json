{"uid":"94226ab425ae5af3","name":"test_cannot_use_db_relation","fullName":"tests.integration.sharding_tests.test_sharding_relations#test_cannot_use_db_relation","historyId":"4f2b88d4eef13afa6a8fa5a4e18c08f4","time":{"start":1727146753830,"stop":1727147054566,"duration":300736},"description":"Verify that sharding components cannot use the DB relation.","descriptionHtml":"<p>Verify that sharding components cannot use the DB relation.</p>\n","status":"failed","statusMessage":"AssertionError: unit shard-0 not in blocked state, in blocked","statusTrace":"Traceback (most recent call last):\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 341, in from_call\n    result: TResult | None = func()\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 242, in <lambda>\n    lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    teardown.throw(outcome._exception)\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/_pytest/threadexception.py\", line 92, in pytest_runtest_call\n    yield from thread_exception_runtest_hook()\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/_pytest/threadexception.py\", line 68, in thread_exception_runtest_hook\n    yield\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    teardown.throw(outcome._exception)\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/_pytest/unraisableexception.py\", line 95, in pytest_runtest_call\n    yield from unraisable_exception_runtest_hook()\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/_pytest/unraisableexception.py\", line 70, in unraisable_exception_runtest_hook\n    yield\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    teardown.throw(outcome._exception)\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/_pytest/logging.py\", line 848, in pytest_runtest_call\n    yield from self._runtest_for(item, \"call\")\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/_pytest/logging.py\", line 831, in _runtest_for\n    yield\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    teardown.throw(outcome._exception)\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/_pytest/capture.py\", line 879, in pytest_runtest_call\n    return (yield)\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 167, in _multicall\n    teardown.throw(outcome._exception)\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/_pytest/skipping.py\", line 257, in pytest_runtest_call\n    return (yield)\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/_pytest/runner.py\", line 174, in pytest_runtest_call\n    item.runtest()\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/_pytest/python.py\", line 1627, in runtest\n    self.ihook.pytest_pyfunc_call(pyfuncitem=self)\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_hooks.py\", line 513, in __call__\n    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_manager.py\", line 120, in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 182, in _multicall\n    return outcome.get_result()\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_result.py\", line 100, in get_result\n    raise exc.with_traceback(exc.__traceback__)\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/pluggy/_callers.py\", line 103, in _multicall\n    res = hook_impl.function(*args)\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/_pytest/python.py\", line 159, in pytest_pyfunc_call\n    result = testfunction(**testargs)\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/pytest_asyncio/plugin.py\", line 529, in inner\n    _loop.run_until_complete(task)\n  File \"/usr/lib/python3.10/asyncio/base_events.py\", line 649, in run_until_complete\n    return future.result()\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/tests/integration/sharding_tests/test_sharding_relations.py\", line 138, in test_cannot_use_db_relation\n    await wait_for_mongodb_units_blocked(\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/tests/integration/helpers.py\", line 464, in wait_for_mongodb_units_blocked\n    for attempt in Retrying(stop=stop_after_delay(timeout), wait=wait_fixed(1), reraise=True):\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/tenacity/__init__.py\", line 443, in __iter__\n    do = self.iter(retry_state=retry_state)\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/tenacity/__init__.py\", line 376, in iter\n    result = action(retry_state)\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/tenacity/__init__.py\", line 418, in exc_check\n    raise retry_exc.reraise()\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/.tox/integration/lib/python3.10/site-packages/tenacity/__init__.py\", line 185, in reraise\n    raise self.last_attempt.result()\n  File \"/usr/lib/python3.10/concurrent/futures/_base.py\", line 451, in result\n    return self.__get_result()\n  File \"/usr/lib/python3.10/concurrent/futures/_base.py\", line 403, in __get_result\n    raise self._exception\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/tests/integration/helpers.py\", line 466, in wait_for_mongodb_units_blocked\n    await check_all_units_blocked_with_status(ops_test, db_app_name, status)\n  File \"/home/ubuntu/actions-runner/_work/mongodb-operator/mongodb-operator/tests/integration/helpers.py\", line 449, in check_all_units_blocked_with_status\n    unit.workload_status.message == status\nAssertionError: unit shard-0 not in blocked state, in blocked","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":1,"retriesStatusChange":true,"beforeStages":[{"name":"event_loop","time":{"start":1727144628474,"stop":1727144628474,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"tmp_path_factory","time":{"start":1727144628474,"stop":1727144628474,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"ops_test","time":{"start":1727144628474,"stop":1727144628642,"duration":168},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"abort_on_fail","time":{"start":1727146753830,"stop":1727146753830,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"afterStages":[{"name":"abort_on_fail::0","time":{"start":1727147054570,"stop":1727147054570,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"ops_test::finalizer","time":{"start":1727147054592,"stop":1727147055355,"duration":763},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::2","time":{"start":1727147055363,"stop":1727147055363,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::_close_event_loop","time":{"start":1727147055363,"stop":1727147055363,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"event_loop::_provide_clean_event_loop","time":{"start":1727147055363,"stop":1727147055367,"duration":4},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"abort_on_fail"},{"name":"tag","value":"group(1)"},{"name":"tag","value":"runner(['self-hosted', 'linux', 'X64', 'jammy', 'large'])"},{"name":"tag","value":"asyncio"},{"name":"parentSuite","value":"tests.integration.sharding_tests"},{"name":"suite","value":"test_sharding_relations"},{"name":"host","value":"github-runner"},{"name":"thread","value":"11514-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.integration.sharding_tests.test_sharding_relations"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[{"uid":"fedd1d43fb29df07","status":"unknown","time":{}}],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":2,"broken":11,"skipped":0,"passed":43,"unknown":1,"total":57},"items":[{"uid":"9f2000710a2dd668","reportUrl":"../2293//#testresult/9f2000710a2dd668","status":"passed","time":{"start":1727059836760,"stop":1727059937678,"duration":100918}},{"uid":"ef32261ccbf4ebb","reportUrl":"../2292//#testresult/ef32261ccbf4ebb","status":"passed","time":{"start":1726971073042,"stop":1726971159526,"duration":86484}},{"uid":"12e14ab4478dfed0","reportUrl":"../2291//#testresult/12e14ab4478dfed0","status":"passed","time":{"start":1726884487429,"stop":1726884589878,"duration":102449}},{"uid":"c88052bf406d5082","reportUrl":"../2290//#testresult/c88052bf406d5082","status":"passed","time":{"start":1726797755046,"stop":1726797846471,"duration":91425}},{"uid":"b75fd11428b085b1","reportUrl":"../2289//#testresult/b75fd11428b085b1","status":"passed","time":{"start":1726712458451,"stop":1726712555458,"duration":97007}},{"uid":"e013e985b0e2590c","reportUrl":"../2286//#testresult/e013e985b0e2590c","status":"passed","time":{"start":1726625793461,"stop":1726625884744,"duration":91283}},{"uid":"825531d5bca3440f","reportUrl":"../2282//#testresult/825531d5bca3440f","status":"passed","time":{"start":1726537422919,"stop":1726537502222,"duration":79303}},{"uid":"b5421aa3075cdf3d","reportUrl":"../2275//#testresult/b5421aa3075cdf3d","status":"passed","time":{"start":1726451639621,"stop":1726451725183,"duration":85562}},{"uid":"f287d5866274a515","reportUrl":"../2274//#testresult/f287d5866274a515","status":"passed","time":{"start":1726364793650,"stop":1726364895429,"duration":101779}},{"uid":"9bd8a7f58bc1894","reportUrl":"../2273//#testresult/9bd8a7f58bc1894","status":"passed","time":{"start":1726278628815,"stop":1726278732178,"duration":103363}},{"uid":"b08011ba0de486fe","reportUrl":"../2272//#testresult/b08011ba0de486fe","status":"passed","time":{"start":1726191927601,"stop":1726192022086,"duration":94485}},{"uid":"221262e90f29d304","reportUrl":"../2270//#testresult/221262e90f29d304","status":"passed","time":{"start":1726105787426,"stop":1726105879391,"duration":91965}},{"uid":"c6366729071f22a5","reportUrl":"../2260//#testresult/c6366729071f22a5","status":"passed","time":{"start":1726024585956,"stop":1726024670840,"duration":84884}},{"uid":"b264ab971570e4c6","reportUrl":"../2253//#testresult/b264ab971570e4c6","status":"passed","time":{"start":1725935662576,"stop":1725935764380,"duration":101804}},{"uid":"408c7fc27e7eb4c3","reportUrl":"../2244//#testresult/408c7fc27e7eb4c3","status":"passed","time":{"start":1725847156486,"stop":1725847256247,"duration":99761}},{"uid":"90efa77177fabfea","reportUrl":"../2242//#testresult/90efa77177fabfea","status":"passed","time":{"start":1725760606271,"stop":1725760690838,"duration":84567}},{"uid":"6f5a835d83539536","reportUrl":"../2240//#testresult/6f5a835d83539536","status":"broken","statusDetails":"juju.errors.JujuUnitError: Unit in error: shard/0","time":{"start":1725674489712,"stop":1725674564186,"duration":74474}},{"uid":"2a22812a97247f44","reportUrl":"../2235//#testresult/2a22812a97247f44","status":"passed","time":{"start":1725587198377,"stop":1725587285069,"duration":86692}},{"uid":"b747a75321d1f81d","reportUrl":"../2232//#testresult/b747a75321d1f81d","status":"broken","statusDetails":"juju.errors.JujuUnitError: Unit in error: shard/0","time":{"start":1725501317813,"stop":1725501384061,"duration":66248}},{"uid":"d903bfb56dd9f3e6","reportUrl":"../2228//#testresult/d903bfb56dd9f3e6","status":"broken","statusDetails":"juju.errors.JujuUnitError: Unit in error: shard/0","time":{"start":1725414189653,"stop":1725414268042,"duration":78389}}]},"tags":["runner(['self-hosted', 'linux', 'X64', 'jammy', 'large'])","asyncio","abort_on_fail","group(1)"]},"source":"94226ab425ae5af3.json","parameterValues":[]}