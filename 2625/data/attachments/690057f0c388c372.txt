[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  config-server-one/0 [allocating] waiting: waiting for machine
  config-server-one/1 [allocating] waiting: waiting for machine
  shard-one/0 [allocating] waiting: waiting for machine
  shard-one/1 [allocating] waiting: waiting for machine
  shard-two/0 [allocating] waiting: waiting for machine
  shard-two/1 [allocating] waiting: waiting for machine
  shard-three/0 [allocating] waiting: waiting for machine
  shard-three/1 [allocating] waiting: waiting for machine
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  config-server-one/0 [allocating] waiting: waiting for machine
  config-server-one/1 [allocating] waiting: waiting for machine
  shard-one/0 [allocating] waiting: waiting for machine
  shard-one/1 [allocating] waiting: waiting for machine
  shard-two/0 [allocating] waiting: waiting for machine
  shard-two/1 [allocating] waiting: waiting for machine
  shard-three/0 [allocating] waiting: waiting for machine
  shard-three/1 [allocating] waiting: waiting for machine
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  config-server-one/0 [allocating] waiting: waiting for machine
  config-server-one/1 [allocating] waiting: waiting for machine
  shard-one/0 [allocating] waiting: waiting for machine
  shard-one/1 [allocating] waiting: waiting for machine
  shard-two/0 [allocating] waiting: waiting for machine
  shard-two/1 [allocating] waiting: waiting for machine
  shard-three/0 [allocating] waiting: waiting for machine
  shard-three/1 [allocating] waiting: waiting for machine
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  config-server-one/0 [allocating] waiting: waiting for machine
  config-server-one/1 [allocating] waiting: waiting for machine
  shard-one/0 [allocating] waiting: waiting for machine
  shard-one/1 [allocating] waiting: waiting for machine
  shard-two/0 [allocating] waiting: waiting for machine
  shard-two/1 [allocating] waiting: waiting for machine
  shard-three/0 [allocating] waiting: waiting for machine
  shard-three/1 [allocating] waiting: waiting for machine
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  config-server-one/0 [allocating] waiting: waiting for machine
  config-server-one/1 [allocating] waiting: waiting for machine
  shard-one/0 [allocating] waiting: waiting for machine
  shard-one/1 [allocating] waiting: waiting for machine
  shard-two/0 [allocating] waiting: waiting for machine
  shard-two/1 [allocating] waiting: waiting for machine
  shard-three/0 [allocating] waiting: waiting for machine
  shard-three/1 [allocating] waiting: waiting for machine
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  config-server-one/0 [allocating] waiting: agent initialising
  config-server-one/1 [allocating] waiting: agent initialising
  shard-one/0 [allocating] waiting: agent initialising
  shard-one/1 [allocating] waiting: agent initialising
  shard-two/0 [allocating] waiting: waiting for machine
  shard-two/1 [allocating] waiting: waiting for machine
  shard-three/0 [allocating] waiting: waiting for machine
  shard-three/1 [allocating] waiting: waiting for machine
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  config-server-one/0 [executing] maintenance: installing MongoDB
  config-server-one/1 [executing] maintenance: installing MongoDB
  shard-one/0 [executing] maintenance: installing MongoDB
  shard-one/1 [executing] maintenance: installing MongoDB
  shard-two/0 [executing] maintenance: installing charm software
  shard-two/1 [allocating] waiting: agent initialising
  shard-three/0 [allocating] waiting: waiting for machine
  shard-three/1 [allocating] waiting: waiting for machine
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  config-server-one/0 [executing] active: 
  config-server-one/1 [executing] active: 
  shard-one/0 [executing] active: 
  shard-one/1 [executing] active: 
  shard-two/0 [executing] maintenance: Adding shard to config-server
  shard-two/1 [executing] maintenance: Adding shard to config-server
  shard-three/0 [allocating] waiting: waiting for machine
  shard-three/1 [allocating] waiting: waiting for machine
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  config-server-one/0 [executing] waiting: Waiting for shards to upgrade/downgrade to revision 1+dfeb7f0-dirty-locally built.
  config-server-one/1 [executing] active: 
  shard-one/0 [idle] active: 
  shard-one/1 [idle] active: 
  shard-two/0 [executing] active: 
  shard-two/1 [executing] active: 
  shard-three/0 [executing] maintenance: installing MongoDB
  shard-three/1 [executing] maintenance: installing MongoDB
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  config-server-one/0 [executing] maintenance: Adding shard shard-two to config-server
  config-server-one/1 [executing] active: 
  shard-one/0 [executing] active: 
  shard-one/1 [executing] active: 
  shard-two/0 [executing] active: 
  shard-two/1 [executing] active: 
  shard-three/0 [executing] active: 
  shard-three/1 [executing] active: 
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  config-server-one/0 [executing] active: 
  config-server-one/1 [executing] active: 
  shard-one/0 [executing] active: 
  shard-one/1 [executing] active: 
  shard-two/0 [executing] active: 
  shard-two/1 [executing] active: 
  shard-three/0 [executing] active: 
  shard-three/1 [executing] active: 
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  config-server-one/0 [idle] active: Primary
  shard-one/0 [idle] waiting: Waiting for primary re-election.
  shard-one/1 [executing] active: 
  shard-two/0 [idle] active: 
  shard-two/1 [idle] active: 
  shard-three/0 [idle] active: 
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  shard-one/0 [idle] waiting: Waiting for primary re-election.
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  shard-one/0 [idle] waiting: Waiting for primary re-election.
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  shard-one/0 [idle] waiting: Waiting for primary re-election.
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  shard-one/0 [idle] waiting: Waiting for primary re-election.
[32mINFO    [0m juju.model:__init__.py:3254 Waiting for model:
  config-server-one/0 [idle] active: 
  config-server-one/1 [idle] active: 
  shard-one/0 [idle] active: Primary
[32mINFO    [0m pytest_operator.plugin:plugin.py:903 Model status:

Model  Controller           Cloud/Region         Version  SLA          Timestamp
test   localhost-localhost  localhost/localhost  3.6.1    unsupported  02:01:06Z

App                Version  Status  Scale  Charm    Channel  Rev  Exposed  Message
config-server-one  6.0.6    active      2  mongodb             0  no       
shard-one          6.0.6    active      2  mongodb             1  no       
shard-three        6.0.6    active      2  mongodb             3  no       
shard-two          6.0.6    active      2  mongodb             2  no       

Unit                  Workload  Agent  Machine  Public address  Ports            Message
config-server-one/0*  active    idle   0        10.182.217.103  27017-27018/tcp  Primary
config-server-one/1   active    idle   1        10.182.217.34   27017-27018/tcp  
shard-one/0           active    idle   2        10.182.217.234  27017/tcp        Primary
shard-one/1*          active    idle   3        10.182.217.174  27017/tcp        
shard-three/0*        active    idle   6        10.182.217.64   27017/tcp        Primary
shard-three/1         active    idle   7        10.182.217.56   27017/tcp        
shard-two/0*          active    idle   4        10.182.217.16   27017/tcp        
shard-two/1           active    idle   5        10.182.217.67   27017/tcp        Primary

Machine  State    Address         Inst id        Base          AZ  Message
0        started  10.182.217.103  juju-1d66b5-0  ubuntu@22.04      Running
1        started  10.182.217.34   juju-1d66b5-1  ubuntu@22.04      Running
2        started  10.182.217.234  juju-1d66b5-2  ubuntu@22.04      Running
3        started  10.182.217.174  juju-1d66b5-3  ubuntu@22.04      Running
4        started  10.182.217.16   juju-1d66b5-4  ubuntu@22.04      Running
5        started  10.182.217.67   juju-1d66b5-5  ubuntu@22.04      Running
6        started  10.182.217.64   juju-1d66b5-6  ubuntu@22.04      Running
7        started  10.182.217.56   juju-1d66b5-7  ubuntu@22.04      Running

[32mINFO    [0m pytest_operator.plugin:plugin.py:909 Juju error logs:

machine-0: 01:54:57 ERROR juju.worker.dependency "lxd-container-provisioner" manifold worker returned unexpected error: container types not yet available
machine-0: 01:54:57 ERROR juju.worker.dependency "kvm-container-provisioner" manifold worker returned unexpected error: container types not yet available
unit-config-server-one-0: 01:54:57 ERROR juju.worker.meterstatus error running "meter-status-changed": charm missing from disk
machine-1: 01:54:59 ERROR juju.worker.dependency "kvm-container-provisioner" manifold worker returned unexpected error: container types not yet available
machine-1: 01:54:59 ERROR juju.worker.dependency "lxd-container-provisioner" manifold worker returned unexpected error: container types not yet available
unit-config-server-one-1: 01:54:59 ERROR juju.worker.meterstatus error running "meter-status-changed": charm missing from disk
machine-3: 01:55:02 ERROR juju.worker.dependency "lxd-container-provisioner" manifold worker returned unexpected error: container types not yet available
machine-3: 01:55:02 ERROR juju.worker.dependency "kvm-container-provisioner" manifold worker returned unexpected error: container types not yet available
unit-shard-one-1: 01:55:03 ERROR juju.worker.meterstatus error running "meter-status-changed": charm missing from disk
machine-2: 01:55:03 ERROR juju.worker.dependency "lxd-container-provisioner" manifold worker returned unexpected error: container types not yet available
machine-2: 01:55:03 ERROR juju.worker.dependency "kvm-container-provisioner" manifold worker returned unexpected error: container types not yet available
unit-shard-one-0: 01:55:03 ERROR juju.worker.meterstatus error running "meter-status-changed": charm missing from disk
machine-4: 01:55:23 ERROR juju.worker.dependency "kvm-container-provisioner" manifold worker returned unexpected error: container types not yet available
machine-4: 01:55:23 ERROR juju.worker.dependency "lxd-container-provisioner" manifold worker returned unexpected error: container types not yet available
unit-shard-two-0: 01:55:23 ERROR juju.worker.meterstatus error running "meter-status-changed": charm missing from disk
machine-5: 01:55:27 ERROR juju.worker.dependency "kvm-container-provisioner" manifold worker returned unexpected error: container types not yet available
machine-5: 01:55:27 ERROR juju.worker.dependency "lxd-container-provisioner" manifold worker returned unexpected error: container types not yet available
unit-shard-two-1: 01:55:27 ERROR juju.worker.meterstatus error running "meter-status-changed": charm missing from disk
unit-config-server-one-0: 01:55:43 ERROR unit.config-server-one/0.juju-log Unable to set params: ['vm.max_map_count']
unit-config-server-one-0: 01:55:43 ERROR unit.config-server-one/0.juju-log Error setting values on sysctl: Unable to set params: ['vm.max_map_count']
unit-shard-one-1: 01:55:44 ERROR unit.shard-one/1.juju-log Unable to set params: ['vm.max_map_count']
unit-shard-one-1: 01:55:44 ERROR unit.shard-one/1.juju-log Error setting values on sysctl: Unable to set params: ['vm.max_map_count']
unit-config-server-one-1: 01:55:46 ERROR unit.config-server-one/1.juju-log Unable to set params: ['vm.max_map_count']
unit-config-server-one-1: 01:55:46 ERROR unit.config-server-one/1.juju-log Error setting values on sysctl: Unable to set params: ['vm.max_map_count']
unit-shard-one-0: 01:55:47 ERROR unit.shard-one/0.juju-log Unable to set params: ['vm.max_map_count']
unit-shard-one-0: 01:55:47 ERROR unit.shard-one/0.juju-log Error setting values on sysctl: Unable to set params: ['vm.max_map_count']
unit-shard-two-0: 01:56:01 ERROR unit.shard-two/0.juju-log Unable to set params: ['vm.max_map_count']
unit-shard-two-0: 01:56:01 ERROR unit.shard-two/0.juju-log Error setting values on sysctl: Unable to set params: ['vm.max_map_count']
unit-shard-two-1: 01:56:07 ERROR unit.shard-two/1.juju-log Unable to set params: ['vm.max_map_count']
unit-shard-two-1: 01:56:07 ERROR unit.shard-two/1.juju-log Error setting values on sysctl: Unable to set params: ['vm.max_map_count']
machine-6: 01:56:17 ERROR juju.worker.dependency "kvm-container-provisioner" manifold worker returned unexpected error: container types not yet available
machine-6: 01:56:17 ERROR juju.worker.dependency "lxd-container-provisioner" manifold worker returned unexpected error: container types not yet available
unit-shard-three-0: 01:56:17 ERROR juju.worker.meterstatus error running "meter-status-changed": charm missing from disk
machine-7: 01:56:19 ERROR juju.worker.dependency "kvm-container-provisioner" manifold worker returned unexpected error: container types not yet available
machine-7: 01:56:19 ERROR juju.worker.dependency "lxd-container-provisioner" manifold worker returned unexpected error: container types not yet available
unit-shard-three-1: 01:56:19 ERROR juju.worker.meterstatus error running "meter-status-changed": charm missing from disk
unit-shard-three-0: 01:56:49 ERROR unit.shard-three/0.juju-log Unable to set params: ['vm.max_map_count']
unit-shard-three-0: 01:56:49 ERROR unit.shard-three/0.juju-log Error setting values on sysctl: Unable to set params: ['vm.max_map_count']
unit-shard-three-1: 01:56:50 ERROR unit.shard-three/1.juju-log Unable to set params: ['vm.max_map_count']
unit-shard-three-1: 01:56:50 ERROR unit.shard-three/1.juju-log Error setting values on sysctl: Unable to set params: ['vm.max_map_count']
unit-config-server-one-0: 01:57:06 ERROR unit.config-server-one/0.juju-log database-peers:0: shard-three shard does not have the same auth as the config server.
unit-config-server-one-0: 01:57:06 ERROR unit.config-server-one/0.juju-log database-peers:0: Uncaught exception while in charm code:
Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-config-server-one-0/charm/venv/lib/python3.10/site-packages/single_kernel_mongo/managers/sharding.py", line 292, in add_shard
    mongo.add_shard(shard_name, hosts)
  File "/var/lib/juju/agents/unit-config-server-one-0/charm/venv/lib/python3.10/site-packages/single_kernel_mongo/utils/mongo_connection.py", line 406, in add_shard
    self.client.admin.command("addShard", shard_url)
  File "/var/lib/juju/agents/unit-config-server-one-0/charm/venv/lib/python3.10/site-packages/pymongo/_csot.py", line 119, in csot_wrapper
    return func(self, *args, **kwargs)
  File "/var/lib/juju/agents/unit-config-server-one-0/charm/venv/lib/python3.10/site-packages/pymongo/synchronous/database.py", line 930, in command
    return self._command(
  File "/var/lib/juju/agents/unit-config-server-one-0/charm/venv/lib/python3.10/site-packages/pymongo/synchronous/database.py", line 770, in _command
    return conn.command(
  File "/var/lib/juju/agents/unit-config-server-one-0/charm/venv/lib/python3.10/site-packages/pymongo/synchronous/helpers.py", line 47, in inner
    return func(*args, **kwargs)
  File "/var/lib/juju/agents/unit-config-server-one-0/charm/venv/lib/python3.10/site-packages/pymongo/synchronous/pool.py", line 536, in command
    return command(
  File "/var/lib/juju/agents/unit-config-server-one-0/charm/venv/lib/python3.10/site-packages/pymongo/synchronous/network.py", line 213, in command
    helpers_shared._check_command_response(
  File "/var/lib/juju/agents/unit-config-server-one-0/charm/venv/lib/python3.10/site-packages/pymongo/helpers_shared.py", line 247, in _check_command_response
    raise OperationFailure(errmsg, code, response, max_wire_version)
pymongo.errors.OperationFailure: Authentication failed., full error: {'ok': 0.0, 'errmsg': 'Authentication failed.', 'code': 18, 'codeName': 'AuthenticationFailed', '$clusterTime': {'clusterTime': Timestamp(1740448626, 1), 'signature': {'hash': b'\x9f\xdb\n\xe8T\xdf\xb5tVj;\xbe\xd43j\xc7\x87\xeb\xcdz', 'keyId': 7475169671340097561}}, 'operationTime': Timestamp(1740448626, 1)}

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-config-server-one-0/charm/src/charm.py", line 25, in <module>
    main(MongoDBVMCharm)
  File "/var/lib/juju/agents/unit-config-server-one-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 551, in main
    manager.run()
  File "/var/lib/juju/agents/unit-config-server-one-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 530, in run
    self._emit()
  File "/var/lib/juju/agents/unit-config-server-one-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 519, in _emit
    _emit_charm_event(self.charm, self.dispatcher.event_name)
  File "/var/lib/juju/agents/unit-config-server-one-0/charm/venv/lib/python3.10/site-packages/ops/main.py", line 147, in _emit_charm_event
    event_to_emit.emit(*args, **kwargs)
  File "/var/lib/juju/agents/unit-config-server-one-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 348, in emit
    framework._emit(event)
  File "/var/lib/juju/agents/unit-config-server-one-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 860, in _emit
    self._reemit(event_path)
  File "/var/lib/juju/agents/unit-config-server-one-0/charm/venv/lib/python3.10/site-packages/ops/framework.py", line 950, in _reemit
    custom_handler(event)
  File "/var/lib/juju/agents/unit-config-server-one-0/charm/venv/lib/python3.10/site-packages/single_kernel_mongo/events/lifecycle.py", line 154, in on_relation_joined
    self.dependent.on_relation_joined()
  File "/var/lib/juju/agents/unit-config-server-one-0/charm/venv/lib/python3.10/site-packages/single_kernel_mongo/managers/mongodb_operator.py", line 413, in on_relation_joined
    self.update_related_hosts()
  File "/var/lib/juju/agents/unit-config-server-one-0/charm/venv/lib/python3.10/site-packages/single_kernel_mongo/managers/mongodb_operator.py", line 692, in update_related_hosts
    self.config_server_manager.add_shards()
  File "/var/lib/juju/agents/unit-config-server-one-0/charm/venv/lib/python3.10/site-packages/single_kernel_mongo/managers/sharding.py", line 275, in add_shards
    self.add_shard(relation)
  File "/var/lib/juju/agents/unit-config-server-one-0/charm/venv/lib/python3.10/site-packages/single_kernel_mongo/managers/sharding.py", line 298, in add_shard
    raise ShardAuthError(shard_name)
single_kernel_mongo.exceptions.ShardAuthError: shard-three
unit-config-server-one-0: 01:57:06 ERROR juju.worker.uniter.operation hook "database-peers-relation-joined" (via hook dispatching script: dispatch) failed: exit status 1
unit-shard-one-1: 01:57:18 ERROR unit.shard-one/1.juju-log sharding:8: Unable to get primary: No replica set members match selector "Primary()", Timeout: 1.0s, Topology Description: <TopologyDescription id: 67bd237d43b85bf061d22652, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('10.182.217.174', 27017) server_type: RSSecondary, rtt: 0.0009428959999695508>, <ServerDescription ('10.182.217.234', 27017) server_type: RSSecondary, rtt: 0.0008770919999960824>]>
unit-shard-two-0: 01:57:21 ERROR unit.shard-two/0.juju-log sharding:9: Unable to get primary: No replica set members match selector "Primary()", Timeout: 1.0s, Topology Description: <TopologyDescription id: 67bd2380435f06553add156e, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('10.182.217.16', 27017) server_type: RSSecondary, rtt: 0.0006697620000295501>, <ServerDescription ('10.182.217.67', 27017) server_type: RSSecondary, rtt: 0.001124728000036157>]>
unit-shard-one-1: 01:57:22 ERROR unit.shard-one/1.juju-log sharding:8: Unable to get primary: No replica set members match selector "Primary()", Timeout: 1.0s, Topology Description: <TopologyDescription id: 67bd238143b85bf061d22653, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('10.182.217.174', 27017) server_type: RSSecondary, rtt: 0.0010178570000789477>, <ServerDescription ('10.182.217.234', 27017) server_type: RSSecondary, rtt: 0.0011458779999884428>]>
unit-shard-two-0: 01:57:25 ERROR unit.shard-two/0.juju-log sharding:9: Unable to get primary: No replica set members match selector "Primary()", Timeout: 1.0s, Topology Description: <TopologyDescription id: 67bd2384435f06553add156f, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('10.182.217.16', 27017) server_type: RSSecondary, rtt: 0.001082477999943876>, <ServerDescription ('10.182.217.67', 27017) server_type: RSSecondary, rtt: 0.0007530090000500422>]>
unit-shard-one-1: 01:57:26 ERROR unit.shard-one/1.juju-log sharding:8: Unable to get primary: No replica set members match selector "Primary()", Timeout: 1.0s, Topology Description: <TopologyDescription id: 67bd238543b85bf061d22654, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('10.182.217.174', 27017) server_type: RSSecondary, rtt: 0.0008998639999617808>, <ServerDescription ('10.182.217.234', 27017) server_type: RSSecondary, rtt: 0.0016794729999674018>]>
unit-shard-two-0: 01:58:06 ERROR unit.shard-two/0.juju-log sharding:9: Unable to get primary: No replica set members match selector "Primary()", Timeout: 1.0s, Topology Description: <TopologyDescription id: 67bd23ad497afec63c113cd3, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('10.182.217.16', 27017) server_type: RSSecondary, rtt: 0.0005973150000500027>, <ServerDescription ('10.182.217.67', 27017) server_type: RSSecondary, rtt: 0.001199259000031816>]>
unit-shard-one-1: 01:58:07 ERROR unit.shard-one/1.juju-log sharding:8: Unable to get primary: No replica set members match selector "Primary()", Timeout: 1.0s, Topology Description: <TopologyDescription id: 67bd23ae00c05ff8d3d96bd8, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('10.182.217.174', 27017) server_type: RSSecondary, rtt: 0.0008244939999713097>, <ServerDescription ('10.182.217.234', 27017) server_type: RSSecondary, rtt: 0.0007366380000348727>]>
unit-shard-one-1: 01:58:11 ERROR unit.shard-one/1.juju-log sharding:8: Unable to get primary: No replica set members match selector "Primary()", Timeout: 1.0s, Topology Description: <TopologyDescription id: 67bd23b200c05ff8d3d96bd9, topology_type: ReplicaSetNoPrimary, servers: [<ServerDescription ('10.182.217.174', 27017) server_type: RSSecondary, rtt: 0.0006177530000286424>, <ServerDescription ('10.182.217.234', 27017) server_type: RSSecondary, rtt: 0.0010705969999662557>]>

[32mINFO    [0m pytest_operator.plugin:plugin.py:991 Forgetting model main...