[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  config-server-one/0 [allocating] waiting: agent initialising
  config-server-one/1 [executing] waiting: agent initialising
  shard-one/0 [allocating] waiting: agent initialising
  shard-one/1 [allocating] waiting: agent initialising
  shard-two/0 [allocating] waiting: waiting for machine
  shard-two/1 [allocating] waiting: waiting for machine
  shard-three/0 [allocating] waiting: waiting for machine
  shard-three/1 [allocating] waiting: waiting for machine
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  config-server-one/0 [executing] maintenance: installing MongoDB
  config-server-one/1 [executing] maintenance: installing MongoDB
  shard-one/0 [allocating] waiting: agent initialising
  shard-one/1 [allocating] waiting: agent initialising
  shard-two/0 [allocating] waiting: waiting for machine
  shard-two/1 [allocating] waiting: waiting for machine
  shard-three/0 [allocating] waiting: waiting for machine
  shard-three/1 [allocating] waiting: waiting for machine
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  config-server-one/0 [executing] maintenance: installing MongoDB
  config-server-one/1 [executing] maintenance: installing MongoDB
  shard-one/0 [executing] maintenance: installing MongoDB
  shard-one/1 [executing] maintenance: installing MongoDB
  shard-two/0 [allocating] waiting: waiting for machine
  shard-two/1 [allocating] waiting: waiting for machine
  shard-three/0 [allocating] waiting: waiting for machine
  shard-three/1 [allocating] waiting: waiting for machine
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  config-server-one/0 [executing] active: 
  config-server-one/1 [executing] maintenance: installing MongoDB
  shard-one/0 [executing] active: 
  shard-one/1 [executing] maintenance: installing MongoDB
  shard-two/0 [allocating] waiting: waiting for machine
  shard-two/1 [allocating] waiting: waiting for machine
  shard-three/0 [allocating] waiting: waiting for machine
  shard-three/1 [allocating] waiting: waiting for machine
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  config-server-one/0 [executing] active: 
  config-server-one/1 [executing] maintenance: installing MongoDB
  shard-one/0 [idle] blocked: Charm revision (6c91b8b-locally built) is not up-to date with config-server.
  shard-one/1 [idle] blocked: Charm revision (6c91b8b-locally built) is not up-to date with config-server.
  shard-two/0 [allocating] waiting: agent initialising
  shard-two/1 [allocating] waiting: waiting for machine
  shard-three/0 [allocating] waiting: waiting for machine
  shard-three/1 [allocating] waiting: waiting for machine
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  config-server-one/0 [executing] waiting: waiting for MongoDB to start
  config-server-one/1 [executing] maintenance: installing MongoDB
  shard-one/0 [executing] waiting: Waiting for secrets from config-server
  shard-one/1 [executing] waiting: Waiting for secrets from config-server
  shard-two/0 [executing] maintenance: installing MongoDB
  shard-two/1 [allocating] waiting: agent initialising
  shard-three/0 [allocating] waiting: waiting for machine
  shard-three/1 [allocating] waiting: waiting for machine
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  config-server-one/0 [executing] maintenance: starting MongoDB
  config-server-one/1 [executing] waiting: Waiting for shards to upgrade/downgrade to revision 6c91b8b-locally built.
  shard-one/0 [idle] waiting: Waiting for secrets from config-server
  shard-one/1 [idle] waiting: Waiting for secrets from config-server
  shard-two/0 [executing] active: 
  shard-two/1 [executing] maintenance: installing MongoDB
  shard-three/0 [allocating] waiting: waiting for machine
  shard-three/1 [allocating] waiting: waiting for machine
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  config-server-one/0 [executing] active: 
  config-server-one/1 [executing] waiting: Waiting for shards to upgrade/downgrade to revision 6c91b8b-locally built.
  shard-one/0 [idle] waiting: Waiting for secrets from config-server
  shard-one/1 [idle] waiting: Waiting for secrets from config-server
  shard-two/0 [idle] waiting: Waiting for secrets from config-server
  shard-two/1 [idle] waiting: Waiting for secrets from config-server
  shard-three/0 [allocating] waiting: agent initialising
  shard-three/1 [allocating] waiting: agent initialising
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  config-server-one/0 [executing] active: 
  config-server-one/1 [executing] waiting: Waiting for shards to upgrade/downgrade to revision 6c91b8b-locally built.
  shard-one/0 [executing] waiting: Waiting for secrets from config-server
  shard-one/1 [executing] waiting: Waiting for secrets from config-server
  shard-two/0 [executing] waiting: Waiting for secrets from config-server
  shard-two/1 [executing] waiting: Waiting for secrets from config-server
  shard-three/0 [executing] active: 
  shard-three/1 [idle] error: hook failed: "start"
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  config-server-one/0 [executing] active: 
  config-server-one/1 [executing] active: 
  shard-one/0 [idle] waiting: Waiting for secrets from config-server
  shard-one/1 [idle] waiting: Waiting for secrets from config-server
  shard-two/0 [idle] waiting: Waiting for secrets from config-server
  shard-two/1 [idle] waiting: Waiting for secrets from config-server
  shard-three/0 [executing] waiting: Waiting for secrets from config-server
  shard-three/1 [idle] waiting: Waiting for secrets from config-server
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  config-server-one/0 [idle] active: 
  config-server-one/1 [executing] maintenance: Adding shard shard-one to config-server
  shard-one/0 [executing] waiting: Waiting for secrets from config-server
  shard-one/1 [executing] waiting: Waiting for secrets from config-server
  shard-two/0 [executing] waiting: Waiting for secrets from config-server
  shard-two/1 [executing] waiting: Waiting for secrets from config-server
  shard-three/0 [idle] waiting: Waiting for secrets from config-server
  shard-three/1 [idle] waiting: Waiting for secrets from config-server
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  config-server-one/1 [executing] maintenance: Adding shard shard-three to config-server
  shard-one/0 [idle] waiting: Waiting for secrets from config-server
  shard-one/1 [idle] waiting: Waiting for secrets from config-server
  shard-two/0 [idle] waiting: Waiting for secrets from config-server
  shard-two/1 [idle] active: Primary
  shard-three/0 [executing] waiting: Waiting for secrets from config-server
  shard-three/1 [executing] waiting: Waiting for secrets from config-server
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  config-server-one/0 [idle] active: 
  config-server-one/1 [idle] active: 
  shard-one/0 [idle] waiting: Waiting for secrets from config-server
  shard-one/1 [idle] waiting: Waiting for secrets from config-server
  shard-two/0 [idle] waiting: Waiting for secrets from config-server
  shard-three/0 [executing] waiting: Waiting for secrets from config-server
  shard-three/1 [executing] waiting: Waiting for secrets from config-server
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  config-server-one/0 [idle] active: 
  config-server-one/1 [idle] active: 
  shard-one/0 [idle] waiting: Waiting for secrets from config-server
  shard-one/1 [idle] waiting: Waiting for secrets from config-server
  shard-two/0 [idle] waiting: Waiting for secrets from config-server
  shard-three/0 [idle] waiting: Waiting for secrets from config-server
  shard-three/1 [idle] active: Primary
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  config-server-one/0 [executing] active: 
  config-server-one/1 [executing] active: 
  shard-one/0 [idle] active: 
  shard-one/1 [idle] waiting: Waiting for secrets from config-server
  shard-two/0 [idle] waiting: Waiting for secrets from config-server
  shard-three/0 [idle] active: 
  shard-three/1 [idle] active: Primary
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  config-server-one/0 [idle] active: 
  config-server-one/1 [idle] active: 
  shard-one/1 [idle] active: Primary
  shard-two/0 [idle] waiting: Waiting for secrets from config-server
[32mINFO    [0m juju.model:model.py:2971 Waiting for model:
  config-server-one/0 [idle] active: 
  config-server-one/1 [idle] active: 
  shard-two/0 [idle] active: 
  shard-two/1 [idle] active: Primary
[32mINFO    [0m pytest_operator.plugin:plugin.py:903 Model status:

Model  Controller           Cloud/Region         Version  SLA          Timestamp
test   localhost-localhost  localhost/localhost  3.5.3    unsupported  04:09:37Z

App                Version  Status  Scale  Charm    Channel  Rev  Exposed  Message
config-server-one           active      2  mongodb             0  no       
shard-one                   active      2  mongodb             1  no       
shard-three                 active      2  mongodb             3  no       
shard-two                   active      2  mongodb             2  no       

Unit                  Workload  Agent  Machine  Public address  Ports            Message
config-server-one/0   active    idle   0        10.91.162.100   27017-27018/tcp  
config-server-one/1*  active    idle   1        10.91.162.131   27017-27018/tcp  
shard-one/0*          active    idle   2        10.91.162.199   27017/tcp        
shard-one/1           active    idle   3        10.91.162.32    27017/tcp        Primary
shard-three/0*        active    idle   6        10.91.162.44    27017/tcp        
shard-three/1         active    idle   7        10.91.162.97    27017/tcp        Primary
shard-two/0*          active    idle   4        10.91.162.198   27017/tcp        
shard-two/1           active    idle   5        10.91.162.245   27017/tcp        Primary

Machine  State    Address        Inst id        Base          AZ  Message
0        started  10.91.162.100  juju-33fe3f-0  ubuntu@22.04      Running
1        started  10.91.162.131  juju-33fe3f-1  ubuntu@22.04      Running
2        started  10.91.162.199  juju-33fe3f-2  ubuntu@22.04      Running
3        started  10.91.162.32   juju-33fe3f-3  ubuntu@22.04      Running
4        started  10.91.162.198  juju-33fe3f-4  ubuntu@22.04      Running
5        started  10.91.162.245  juju-33fe3f-5  ubuntu@22.04      Running
6        started  10.91.162.44   juju-33fe3f-6  ubuntu@22.04      Running
7        started  10.91.162.97   juju-33fe3f-7  ubuntu@22.04      Running

[32mINFO    [0m pytest_operator.plugin:plugin.py:909 Juju error logs:

machine-1: 04:00:16 ERROR juju.worker.dependency "lxd-container-provisioner" manifold worker returned unexpected error: container types not yet available
machine-1: 04:00:16 ERROR juju.worker.dependency "kvm-container-provisioner" manifold worker returned unexpected error: container types not yet available
unit-config-server-one-1: 04:00:17 ERROR juju.worker.meterstatus error running "meter-status-changed": charm missing from disk
machine-0: 04:00:21 ERROR juju.worker.dependency "lxd-container-provisioner" manifold worker returned unexpected error: container types not yet available
machine-0: 04:00:21 ERROR juju.worker.dependency "kvm-container-provisioner" manifold worker returned unexpected error: container types not yet available
unit-config-server-one-0: 04:00:21 ERROR juju.worker.meterstatus error running "meter-status-changed": charm missing from disk
machine-2: 04:01:13 ERROR juju.worker.dependency "lxd-container-provisioner" manifold worker returned unexpected error: container types not yet available
machine-2: 04:01:13 ERROR juju.worker.dependency "kvm-container-provisioner" manifold worker returned unexpected error: container types not yet available
unit-shard-one-0: 04:01:13 ERROR juju.worker.meterstatus error running "meter-status-changed": charm missing from disk
machine-3: 04:01:19 ERROR juju.worker.dependency "lxd-container-provisioner" manifold worker returned unexpected error: container types not yet available
machine-3: 04:01:19 ERROR juju.worker.dependency "kvm-container-provisioner" manifold worker returned unexpected error: container types not yet available
unit-shard-one-1: 04:01:19 ERROR juju.worker.meterstatus error running "meter-status-changed": charm missing from disk
unit-shard-one-0: 04:03:01 ERROR unit.shard-one/0.juju-log _on_secret_remove: Secret secret:ct97enm5d5u1jrfcug20 seems to have no observers, could be removed
machine-4: 04:03:20 ERROR juju.worker.dependency "kvm-container-provisioner" manifold worker returned unexpected error: container types not yet available
machine-4: 04:03:20 ERROR juju.worker.dependency "lxd-container-provisioner" manifold worker returned unexpected error: container types not yet available
unit-shard-two-0: 04:03:20 ERROR juju.worker.meterstatus error running "meter-status-changed": charm missing from disk
machine-5: 04:03:42 ERROR juju.worker.dependency "kvm-container-provisioner" manifold worker returned unexpected error: container types not yet available
machine-5: 04:03:42 ERROR juju.worker.dependency "lxd-container-provisioner" manifold worker returned unexpected error: container types not yet available
unit-shard-two-1: 04:03:42 ERROR juju.worker.meterstatus error running "meter-status-changed": charm missing from disk
unit-config-server-one-1: 04:04:19 ERROR unit.config-server-one/1.juju-log _on_secret_remove: Secret secret:ct97fbe5d5u1jrfcug2g seems to have no observers, could be removed
machine-6: 04:04:33 ERROR juju.worker.dependency "kvm-container-provisioner" manifold worker returned unexpected error: container types not yet available
machine-6: 04:04:33 ERROR juju.worker.dependency "lxd-container-provisioner" manifold worker returned unexpected error: container types not yet available
unit-shard-three-0: 04:04:33 ERROR juju.worker.meterstatus error running "meter-status-changed": charm missing from disk
machine-7: 04:04:34 ERROR juju.worker.dependency "kvm-container-provisioner" manifold worker returned unexpected error: container types not yet available
machine-7: 04:04:34 ERROR juju.worker.dependency "lxd-container-provisioner" manifold worker returned unexpected error: container types not yet available
unit-shard-three-1: 04:04:34 ERROR juju.worker.meterstatus error running "meter-status-changed": charm missing from disk
unit-shard-two-0: 04:04:34 ERROR unit.shard-two/0.juju-log _on_secret_remove: Secret secret:ct97fe65d5u1jrfcug30 seems to have no observers, could be removed
unit-shard-three-1: 04:05:23 ERROR unit.shard-three/1.juju-log Uncaught exception while in charm code:
Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-shard-three-1/charm/venv/ops/model.py", line 3187, in _run
    result = subprocess.run(args, **kwargs)  # type: ignore
  File "/usr/lib/python3.10/subprocess.py", line 526, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command '('/var/lib/juju/tools/unit-shard-three-1/secret-get', '--label', 'shard-three.app', '--format=json')' returned non-zero exit status 1.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/var/lib/juju/agents/unit-shard-three-1/charm/./src/charm.py", line 1598, in <module>
    main(MongodbOperatorCharm)
  File "/var/lib/juju/agents/unit-shard-three-1/charm/venv/ops/main.py", line 551, in main
    manager.run()
  File "/var/lib/juju/agents/unit-shard-three-1/charm/venv/ops/main.py", line 530, in run
    self._emit()
  File "/var/lib/juju/agents/unit-shard-three-1/charm/venv/ops/main.py", line 519, in _emit
    _emit_charm_event(self.charm, self.dispatcher.event_name)
  File "/var/lib/juju/agents/unit-shard-three-1/charm/venv/ops/main.py", line 147, in _emit_charm_event
    event_to_emit.emit(*args, **kwargs)
  File "/var/lib/juju/agents/unit-shard-three-1/charm/venv/ops/framework.py", line 348, in emit
    framework._emit(event)
  File "/var/lib/juju/agents/unit-shard-three-1/charm/venv/ops/framework.py", line 860, in _emit
    self._reemit(event_path)
  File "/var/lib/juju/agents/unit-shard-three-1/charm/venv/ops/framework.py", line 950, in _reemit
    custom_handler(event)
  File "/var/lib/juju/agents/unit-shard-three-1/charm/./src/charm.py", line 434, in _on_start
    self._instatiate_keyfile(event)
  File "/var/lib/juju/agents/unit-shard-three-1/charm/./src/charm.py", line 1075, in _instatiate_keyfile
    if not (keyfile := self.get_secret(APP_SCOPE, Config.Secrets.SECRET_KEYFILE_NAME)):
  File "/var/lib/juju/agents/unit-shard-three-1/charm/./src/charm.py", line 1300, in get_secret
    secret = self.secrets.get(label)
  File "/var/lib/juju/agents/unit-shard-three-1/charm/lib/charms/mongodb/v0/mongodb_secrets.py", line 137, in get
    if secret.meta:
  File "/var/lib/juju/agents/unit-shard-three-1/charm/lib/charms/mongodb/v0/mongodb_secrets.py", line 85, in meta
    self._secret_meta = self.charm.model.get_secret(label=self.label)
  File "/var/lib/juju/agents/unit-shard-three-1/charm/venv/ops/model.py", line 291, in get_secret
    content = self._backend.secret_get(id=id, label=label)
  File "/var/lib/juju/agents/unit-shard-three-1/charm/venv/ops/model.py", line 3552, in secret_get
    result = self._run('secret-get', *args, return_output=True, use_json=True)
  File "/var/lib/juju/agents/unit-shard-three-1/charm/venv/ops/model.py", line 3189, in _run
    raise ModelError(e.stderr) from e
ops.model.ModelError: ERROR permission denied

unit-shard-three-1: 04:05:24 ERROR juju.worker.uniter.operation hook "start" (via hook dispatching script: dispatch) failed: exit status 1
unit-shard-three-0: 04:05:43 ERROR unit.shard-three/0.juju-log _on_secret_remove: Secret secret:ct97g0u5d5u1jrfcug3g seems to have no observers, could be removed
unit-config-server-one-1: 04:06:20 ERROR unit.config-server-one/1.juju-log config-server:8: Failed to add shard shard-two to the config server, error=OperationFailure('Could not find host matching read preference { mode: "primary" } for set shard-two, full error: {\'ok\': 0.0, \'errmsg\': \'Could not find host matching read preference { mode: "primary" } for set shard-two\', \'code\': 133, \'codeName\': \'FailedToSatisfyReadPreference\', \'$clusterTime\': {\'clusterTime\': Timestamp(1733457979, 3), \'signature\': {\'hash\': b\'\\x90\\x9b\\x82dr%\\xee\\xde\\x1do\\xb5V\\xc2\\x84\\x9aQ\\x0c\\x80\\xfd\\x88\', \'keyId\': 7445144753269637146}}, \'operationTime\': Timestamp(1733457979, 3)}')
unit-config-server-one-1: 04:06:30 ERROR unit.config-server-one/1.juju-log config-server:8: Failed to add shard-two to cluster
unit-config-server-one-1: 04:06:30 ERROR unit.config-server-one/1.juju-log config-server:8: Deferring _on_relation_event for shards interface since: error=OperationFailure('Could not find host matching read preference { mode: "primary" } for set shard-two, full error: {\'ok\': 0.0, \'errmsg\': \'Could not find host matching read preference { mode: "primary" } for set shard-two\', \'code\': 133, \'codeName\': \'FailedToSatisfyReadPreference\', \'$clusterTime\': {\'clusterTime\': Timestamp(1733457979, 3), \'signature\': {\'hash\': b\'\\x90\\x9b\\x82dr%\\xee\\xde\\x1do\\xb5V\\xc2\\x84\\x9aQ\\x0c\\x80\\xfd\\x88\', \'keyId\': 7445144753269637146}}, \'operationTime\': Timestamp(1733457979, 3)}')
unit-shard-two-0: 04:06:44 ERROR unit.shard-two/0.juju-log _on_secret_remove: Secret secret:ct97fe65d5u1jrfcug30 seems to have no observers, could be removed
unit-shard-one-0: 04:06:44 ERROR unit.shard-one/0.juju-log _on_secret_remove: Secret secret:ct97enm5d5u1jrfcug20 seems to have no observers, could be removed
unit-shard-two-0: 04:06:45 ERROR unit.shard-two/0.juju-log _on_secret_remove: Secret secret:ct97fe65d5u1jrfcug30 seems to have no observers, could be removed
unit-shard-one-0: 04:06:45 ERROR unit.shard-one/0.juju-log _on_secret_remove: Secret secret:ct97enm5d5u1jrfcug20 seems to have no observers, could be removed
unit-config-server-one-1: 04:06:50 ERROR unit.config-server-one/1.juju-log config-server:10: Failed to add shard shard-three to the config server, error=OperationFailure("Authentication failed., full error: {'ok': 0.0, 'errmsg': 'Authentication failed.', 'code': 18, 'codeName': 'AuthenticationFailed', '$clusterTime': {'clusterTime': Timestamp(1733458010, 2), 'signature': {'hash': b'3L\\xb8\\xa5\\xab\\x8c)\\xda\\xc7x\\xadA\\x03{j\\x8cE\\xe4\\xd1\\x9c', 'keyId': 7445144753269637146}}, 'operationTime': Timestamp(1733458010, 2)}")
unit-config-server-one-1: 04:06:50 ERROR unit.config-server-one/1.juju-log config-server:10: shard-three shard does not have the same auth as the config server.
unit-config-server-one-1: 04:07:07 ERROR unit.config-server-one/1.juju-log config-server:10: Failed to add shard shard-three to the config server, error=OperationFailure('Could not find host matching read preference { mode: "primary" } for set shard-three, full error: {\'ok\': 0.0, \'errmsg\': \'Could not find host matching read preference { mode: "primary" } for set shard-three\', \'code\': 133, \'codeName\': \'FailedToSatisfyReadPreference\', \'$clusterTime\': {\'clusterTime\': Timestamp(1733458026, 2), \'signature\': {\'hash\': b\'6\\xe64x=\\xb2\\x92)]RZL\\xc8\\xa6\\xb8\\xfb\\xba\\xb6\\xcea\', \'keyId\': 7445144753269637146}}, \'operationTime\': Timestamp(1733458026, 2)}')
unit-config-server-one-1: 04:07:07 ERROR unit.config-server-one/1.juju-log config-server:10: Failed to add shard-three to cluster
unit-config-server-one-1: 04:07:07 ERROR unit.config-server-one/1.juju-log config-server:10: Deferring _on_relation_event for shards interface since: error=OperationFailure('Could not find host matching read preference { mode: "primary" } for set shard-three, full error: {\'ok\': 0.0, \'errmsg\': \'Could not find host matching read preference { mode: "primary" } for set shard-three\', \'code\': 133, \'codeName\': \'FailedToSatisfyReadPreference\', \'$clusterTime\': {\'clusterTime\': Timestamp(1733458026, 2), \'signature\': {\'hash\': b\'6\\xe64x=\\xb2\\x92)]RZL\\xc8\\xa6\\xb8\\xfb\\xba\\xb6\\xcea\', \'keyId\': 7445144753269637146}}, \'operationTime\': Timestamp(1733458026, 2)}')
unit-shard-three-0: 04:07:30 ERROR unit.shard-three/0.juju-log _on_secret_remove: Secret secret:ct97g0u5d5u1jrfcug3g seems to have no observers, could be removed
unit-shard-three-0: 04:07:30 ERROR unit.shard-three/0.juju-log _on_secret_remove: Secret secret:ct97g0u5d5u1jrfcug3g seems to have no observers, could be removed

[32mINFO    [0m pytest_operator.plugin:plugin.py:991 Forgetting model main...